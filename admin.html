<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Pages Admin</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .file-input { margin-bottom: 10px; }
        .file-list { margin-top: 20px; }
        .file { padding: 10px; border: 1px solid #ddd; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>GitHub Pages Admin</h1>
    <button id="auth-btn">Login with GitHub</button>

    <div class="file-input" style="display: none;">
        <input type="file" id="file-upload" />
        <button onclick="uploadFile()">Upload File</button>
    </div>

    <div class="file-list" style="display: none;">
        <h2>Files in Repository:</h2>
        <ul id="file-list"></ul>
    </div>

    <script>
        let accessToken = null;

        const clientId = 'Ov23lip3GJ1eFAUL537S'; // Replace with your OAuth App client ID
        const redirectUri = 'https://unblockedgames660.github.io/auth/callback'; // Replace with your callback URL

        // Step 1: GitHub OAuth Login
        document.getElementById('auth-btn').onclick = function () {
            const authUrl = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}`;
            window.location.href = authUrl;
        };

        // Step 2: Handle GitHub OAuth Callback
        // After GitHub redirects to your callback URL, extract the code parameter and get the access token
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('code')) {
            const code = urlParams.get('code');
            fetchAccessToken(code);
        }

        async function fetchAccessToken(code) {
            const clientSecret = 'ce9899e96b67826059e3a93ce8fcf709874097e3'; // For security, replace this with your server-side handling
            const response = await fetch(`https://github.com/login/oauth/access_token`, {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                },
                body: JSON.stringify({
                    client_id: clientId,
                    client_secret: clientSecret,
                    code: code,
                    redirect_uri: redirectUri
                })
            });

            const data = await response.json();
            accessToken = data.access_token;
            if (accessToken) {
                document.getElementById('auth-btn').style.display = 'none';
                document.querySelector('.file-input').style.display = 'block';
                document.querySelector('.file-list').style.display = 'block';
                listFiles(); // Fetch and list the files from GitHub
            }
        }

        // Step 3: List Files in the Repository
        async function listFiles() {
            const response = await fetch('https://api.github.com/repos/yourusername/yourrepo/contents', {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            });
            const data = await response.json();
            const fileList = document.getElementById('file-list');
            fileList.innerHTML = '';
            data.forEach(file => {
                const li = document.createElement('li');
                li.classList.add('file');
                li.innerHTML = `${file.name} <button onclick="editFile('${file.path}')">Edit</button> <button onclick="deleteFile('${file.path}')">Delete</button>`;
                fileList.appendChild(li);
            });
        }

        // Step 4: Upload File to GitHub Repository
        async function uploadFile() {
            const file = document.getElementById('file-upload').files[0];
            if (file) {
                const content = await file.text();
                const response = await fetch(`https://api.github.com/repos/yourusername/yourrepo/contents/${file.name}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Add new file',
                        content: btoa(content), // Base64 encode the file content
                    })
                });
                const result = await response.json();
                listFiles(); // Refresh file list after upload
            }
        }

        // Step 5: Edit File in GitHub Repository
        async function editFile(path) {
            const response = await fetch(`https://api.github.com/repos/yourusername/yourrepo/contents/${path}`, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            });
            const data = await response.json();
            const content = atob(data.content); // Decode content from Base64
            const newContent = prompt('Edit file content:', content);
            if (newContent !== null) {
                const updateResponse = await fetch(`https://api.github.com/repos/yourusername/yourrepo/contents/${path}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Edit file content',
                        content: btoa(newContent),
                        sha: data.sha, // Needed to update the file
                    })
                });
                const updateResult = await updateResponse.json();
                listFiles(); // Refresh file list after editing
            }
        }

        // Step 6: Delete File from GitHub Repository
        async function deleteFile(path) {
            const response = await fetch(`https://api.github.com/repos/yourusername/yourrepo/contents/${path}`, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            });
            const data = await response.json();
            const deleteResponse = await fetch(`https://api.github.com/repos/yourusername/yourrepo/contents/${path}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: 'Delete file',
                    sha: data.sha,
                })
            });
            const deleteResult = await deleteResponse.json();
            listFiles(); // Refresh file list after deletion
        }
    </script>
</body>
</html>
